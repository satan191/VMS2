# BQ-Pro 安防监控平台

一个专业的视频监控与设备管理解决方案前端原型，类似 Milestone Systems 和 Hikvision 的厂商产品。

## 项目概述

**BQ-Pro 安防监控平台** 是一个统一的监控与设备管理解决方案，整合了以下核心功能：

- **视频监控** - 实时监控、视频回放、PTZ云台控制
- **告警管理** - 告警事件筛选、历史告警查询
- **资产管理** - 设备总览、GIS地图展示、资产清单
- **日志维护** - 系统日志查询、导出和分析
- **系统设置** - 平台配置和参数管理

> **架构说明**：原先分为VMS客户端和DMS设备管理系统两个独立应用，现已整合为统一平台，所有功能在一个界面中访问。

## 技术栈

- **框架**: React 18 + TypeScript
- **构建工具**: Vite
- **路由**: React Router DOM v6
- **样式**: Tailwind CSS
- **UI 组件**: 自定义组件 + Lucide React 图标库
- **地图**: Leaflet + React-Leaflet
- **图表**: Recharts

## 项目结构

```
监控平台/
├── src/
│   ├── components/          # 可复用组件
│   │   ├── vms/            # VMS 客户端组件
│   │   │   ├── VMSLayout.tsx      # VMS 主布局
│   │   │   ├── DeviceTree.tsx     # 设备树(VMS-02)
│   │   │   ├── VideoGrid.tsx      # 视频播放区(VMS-03)
│   │   │   ├── PTZControl.tsx     # PTZ 控制(VMS-05)
│   │   │   └── TimelineControl.tsx # 时间轴控制(VMS-07)
│   │   └── dms/            # DMS 组件
│   │       └── DMSLayout.tsx      # DMS 主布局
│   ├── pages/              # 页面组件
│   │   ├── vms/
│   │   │   ├── RealTimeMonitor.tsx  # 实时监控面板
│   │   │   └── PlaybackPanel.tsx    # 回放取证面板
│   │   └── dms/
│   │       ├── Dashboard.tsx        # 资产总览面板
│   │       └── LogService.tsx       # 日志维护面板
│   ├── data/               # 模拟数据
│   │   └── mockData.ts
│   ├── types/              # TypeScript 类型定义
│   │   └── index.ts
│   ├── utils/              # 工具函数
│   │   └── cn.ts           # 样式合并工具
│   ├── styles/             # 全局样式
│   │   └── globals.css
│   ├── App.tsx             # 应用主组件
│   └── main.tsx            # 应用入口
├── public/                 # 静态资源
├── index.html             # HTML 模板
├── package.json           # 项目依赖
├── vite.config.ts         # Vite 配置
├── tsconfig.json          # TypeScript 配置
└── tailwind.config.js     # Tailwind CSS 配置
```

## 功能模块

平台提供以下功能模块，通过顶部导航栏快速切换：

### 1. 实时监控面板 (Real-Time Monitor)
- **VMS-01**: 顶部导航栏，快速切换工作模式
- **VMS-02**: 左侧设备树
  - 树状结构展示所有摄像机
  - 支持拖拽操作到视频窗口
  - 显示设备在线/离线/故障状态
- **VMS-03**: 视频播放区
  - 支持 1/4/9/16 画面布局切换
  - 双击全屏显示
  - OSD 信息展示（设备名称、分辨率、码流类型）
  - 主码流/子码流无缝切换
- **VMS-05**: PTZ 云台控制面板
  - 方向盘样式控制（8方向+中心）
  - 变倍控制（放大/缩小）
  - 预置位管理（添加、调用）

### 2. 回放与取证面板 (Playback Panel)
- **VMS-06**: 日期和摄像机选择
  - 日历视图选择有录像的日期
  - 下拉选择摄像机
- **VMS-07**: 录像时间轴
  - 24小时时间刻度显示
  - 不同颜色区分录像类型（连续/事件/移动侦测）
  - 拖动播放进度条
  - 框选时间段导出视频
- **VMS-09**: 告警事件筛选
  - 按告警类型筛选（移动侦测、越界、入侵、人脸、车辆）
  - 时间轴上显示告警标记

### 3. 告警管理面板 (Alarms Panel)
- 告警事件列表
- 按类型筛选（移动侦测、越界、入侵等）
- 告警详情查看
- 告警确认和处理

### 4. 资产总览面板 (Dashboard)
- **DMS-01**: 运营指标卡
  - 设备总数、在线设备、离线设备、故障设备
  - 点击卡片快速筛选对应状态设备
- **DMS-02**: GIS 地图视图
  - 基于 Leaflet 的地图展示
  - 设备位置标注（颜色区分状态）
  - 悬停显示设备信息
  - 点击弹出详细信息
- **DMS-03**: 资产清单表格
  - 完整设备信息展示（名称、IP、类型、分组、分辨率、固件版本、状态）
  - 多字段排序和筛选
  - 批量选择设备
  - 批量固件升级功能
- **DMS-04**: 设备详情侧边栏
  - 完整的设备参数信息
  - 固件升级操作
  - 配置导出功能

### 5. 日志与维护面板 (Log Service)
- **DMS-05**: 日志查询区
  - 时间范围选择
  - 日志级别筛选（Info/Warning/Error）
  - 日志类型筛选（设备运行/事件触发/操作行为/系统）
  - 关键词搜索
- **DMS-06**: 日志详情列表
  - 时间戳、设备ID、日志级别、详情描述
  - 点击查看完整日志详情
  - JSON 格式展示详细信息
  - 导出日志功能

## 快速开始

### 1. 安装依赖

```bash
npm install
```

### 2. 启动开发服务器

```bash
npm run dev
```

应用将在 `http://localhost:3000` 启动。

### 3. 构建生产版本

```bash
npm run build
```

构建产物将生成在 `dist/` 目录。

### 4. 预览生产构建

```bash
npm run preview
```

## 数据说明

### 模拟数据文件

所有数据都在 `src/data/mockData.ts` 中定义：

- **mockCameras**: 8台摄像机设备数据
- **mockRecordings**: 录像片段数据
- **mockAlarms**: 告警事件数据
- **mockLogs**: 日志记录数据

### 类型定义

所有 TypeScript 类型定义在 `src/types/index.ts`：

- **Camera**: 摄像机设备类型
- **RecordingSegment**: 录像片段类型
- **AlarmEvent**: 告警事件类型
- **LogEntry**: 日志条目类型
- **PTZPreset**: PTZ预置位类型
- **VideoLayout**: 视频布局类型（1/4/9/16）
- **StreamType**: 视频流类型（主码流/子码流）

## 核心交互逻辑

### 拖拽功能
- 从设备树拖拽摄像机到视频播放窗口
- 使用原生 HTML5 Drag & Drop API
- 拖拽数据通过 JSON 序列化传递

### 视频布局切换
- 点击布局按钮切换 1/4/9/16 画面
- 使用 CSS Grid 实现响应式布局
- 支持双击单个画面全屏显示

### 时间轴交互
- 点击时间轴跳转到指定时间点
- 框选时间范围导出录像
- 拖动播放进度条同步视频

### 地图交互
- 使用 react-leaflet 集成 OpenStreetMap
- 设备标记点击弹出详细信息
- 支持地图缩放和平移

## 样式设计

### 配色方案

**VMS 客户端** (暗色主题)
- 背景: `gray-950`
- 组件背景: `gray-900`
- 边框: `gray-800`
- 主色调: 蓝色 `blue-600`

**DMS 管理系统** (亮色主题)
- 背景: `gray-100`
- 组件背景: `white`
- 边框: `gray-200`
- 主色调: 蓝色 `blue-600`

### 响应式设计
- 使用 Tailwind CSS 的响应式工具类
- Grid 布局自适应不同屏幕尺寸
- 移动端优化（虽然主要针对桌面应用）

## 浏览器兼容性

- Chrome/Edge (推荐)
- Firefox
- Safari

## 注意事项

1. **这是一个前端原型项目**，所有数据都是模拟数据，没有实际的后端接口
2. **视频播放**使用占位符模拟，实际项目需要集成视频流播放器（如 Video.js、HLS.js）
3. **地图功能**需要网络连接加载 OpenStreetMap 瓦片
4. **实时数据更新**需要集成 WebSocket 或轮询机制
5. **权限管理**和**用户认证**功能未实现

## 后续扩展建议

### 功能扩展
- [ ] 集成真实视频流播放（WebRTC/HLS）
- [ ] 实现用户登录和权限管理
- [ ] 添加告警推送和通知功能
- [ ] 实现设备配置管理
- [ ] 添加统计报表和数据可视化
- [ ] 支持多语言国际化

### 技术优化
- [ ] 使用 Redux/Zustand 进行状态管理
- [ ] 集成 React Query 优化数据获取
- [ ] 添加单元测试和 E2E 测试
- [ ] 实现代码分割和懒加载
- [ ] 优化性能（虚拟滚动、图片懒加载）
- [ ] 添加 PWA 支持

## 代码仓库与版本控制

本项目已托管至 GitHub，地址：[https://github.com/satan191/VMS2](https://github.com/satan191/VMS2)

### 常用命令（给初学者）

如果你修改了代码并想推送到仓库，请在终端执行以下命令：

1. **保存修改**：
   ```bash
   git add .
   git commit -m "描述你修改了什么"
   ```

2. **推送到 GitHub**：
   ```bash
   git push
   ```

## 部署指南 (Zeabur)

本项目已配置好适配 Zeabur 的部署文件，你可以轻松将其发布到互联网，让所有人访问。

### 步骤 1: 准备代码
确保你已经将代码提交到了 GitHub 仓库（参考上文“常用命令”）。

### 步骤 2: 在 Zeabur 上创建项目
1. 访问 [Zeabur 官网](https://zeabur.com) 并注册账号（使用 GitHub 登录即可）。
2. 点击控制台的 **"Create Project" (创建项目)** 按钮。
3. 选择 **"Deploy New Service" (部署新服务)** -> **"GitHub"**。
4. 搜索并选择你的 `VMS` 仓库。
5. Zeabur 会自动识别项目中的 `Dockerfile` 并开始构建。

### 步骤 3: 访问你的网站
1. 等待部署完成后，点击 **"Networking" (网络)** 标签页。
2. 点击 **"Generate Domain" (生成域名)**，Zeabur 会分配一个免费的网址（例如 `your-project.zeabur.app`）。
3. 点击这个网址，你就可以在中国大陆直接访问你的监控平台了！

## 贡献指南

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License

---

**开发团队**: BQ-Pro 安防平台开发组  
**版本**: 1.0.0  
**最后更新**: 2025-11-28

## 更新日志

### v1.1.0 (2025-11-28)
- **架构优化**: 将VMS和DMS整合为统一平台
- **导航优化**: 在VMS主界面中新增"资产总览"和"日志维护"菜单
- **用户体验**: 移除了VMS/DMS之间的切换入口，所有功能在一个界面中访问
- **路由简化**: 所有功能页面统一使用 `/vms/*` 路由

### v1.0.0 (2025-11-12)
- 初始版本发布
- 实现VMS客户端基础功能
- 实现DMS设备管理系统基础功能
